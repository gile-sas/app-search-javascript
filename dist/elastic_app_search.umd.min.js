!(function(e, t) {
  "object" == typeof exports && "undefined" != typeof module
    ? t(exports)
    : "function" == typeof define && define.amd
      ? define(["exports"], t)
      : t((e.ElasticAppSearch = {}));
})(this, function(e) {
  "use strict";
  var s = function(e, t) {
      if (!(e instanceof t))
        throw new TypeError("Cannot call a class as a function");
    },
    t = function(e, t, n) {
      return t && r(e.prototype, t), n && r(e, n), e;
    };
  function r(e, t) {
    for (var n = 0; n < t.length; n++) {
      var r = t[n];
      (r.enumerable = r.enumerable || !1),
        (r.configurable = !0),
        "value" in r && (r.writable = !0),
        Object.defineProperty(e, r.key, r);
    }
  }
  function u(e, t, n) {
    return (
      t in e
        ? Object.defineProperty(e, t, {
            value: n,
            enumerable: !0,
            configurable: !0,
            writable: !0
          })
        : (e[t] = n),
      e
    );
  }
  function l(e) {
    if (Array.isArray(e)) {
      for (var t = 0, n = Array(e.length); t < e.length; t++) n[t] = e[t];
      return n;
    }
    return Array.from(e);
  }
  var h =
      Object.assign ||
      function(e) {
        for (var t = 1; t < arguments.length; t++) {
          var n,
            r = arguments[t];
          for (n in r)
            Object.prototype.hasOwnProperty.call(r, n) && (e[n] = r[n]);
        }
        return e;
      },
    i = function(e, t) {
      var n,
        r = {};
      for (n in e)
        0 <= t.indexOf(n) ||
          (Object.prototype.hasOwnProperty.call(e, n) && (r[n] = e[n]));
      return r;
    },
    f = function(e, t) {
      if (Array.isArray(e)) return e;
      if (Symbol.iterator in Object(e))
        return (function(e, t) {
          var n = [],
            r = !0,
            i = !1,
            a = void 0;
          try {
            for (
              var s, o = e[Symbol.iterator]();
              !(r = (s = o.next()).done) &&
              (n.push(s.value), !t || n.length !== t);
              r = !0
            );
          } catch (e) {
            (i = !0), (a = e);
          } finally {
            try {
              !r && o.return && o.return();
            } finally {
              if (i) throw a;
            }
          }
          return n;
        })(e, t);
      throw new TypeError(
        "Invalid attempt to destructure non-iterable instance"
      );
    },
    a = (t(n, [
      {
        key: "getRaw",
        value: function(e) {
          return (this.data[e] || {}).raw;
        }
      },
      {
        key: "getSnippet",
        value: function(e) {
          return (this.data[e] || {}).snippet;
        }
      }
    ]),
    n);
  function n(e) {
    s(this, n),
      e._group &&
        0 < e._group.length &&
        (e = h({}, e, {
          _group: e._group.map(function(e) {
            return new n(e);
          })
        })),
      (this.data = e);
  }
  function o(e, t) {
    s(this, o), (this.rawResults = e), (this.rawInfo = t);
    var n = new Array();
    e.forEach(function(e) {
      n.push(new a(e));
    }),
      (this.results = n),
      (this.info = t);
  }
  var d = (t(c, [
    {
      key: "removeFilter",
      value: function(e, t) {
        return new c(
          (function r(i, e) {
            e = Object.entries(e).reduce(function(e, t) {
              var n = f(t, 2),
                t = n[0],
                n = n[1];
              return t === i
                ? e
                : (["all", "any", "none"].includes(t) &&
                    (n = n.reduce(function(e, t) {
                      return (t = r(i, t)) ? e.concat(t) : e;
                    }, [])),
                  h({}, e, u({}, t, n)));
            }, {});
            if (0 !== Object.keys(e).length) return e;
          })(e, 1 < arguments.length && void 0 !== t ? t : this.filtersJSON)
        );
      }
    },
    {
      key: "getListOfAppliedFilters",
      value: function(e) {
        var r = this,
          e = 0 < arguments.length && void 0 !== e ? e : this.filtersJSON,
          e = Object.entries(e).reduce(function(n, e) {
            var t = f(e, 2),
              e = t[0],
              t = t[1];
            return (
              ["all", "any", "none"].includes(e)
                ? t.forEach(function(t) {
                    Object.keys(t).forEach(function(e) {
                      ["all", "any", "none"].includes(e)
                        ? (n = new Set(
                            [].concat(l(n), l(r.getListOfAppliedFilters(t)))
                          ))
                        : n.add(e);
                    });
                  })
                : n.add(e),
              n
            );
          }, new Set());
        return Array.from(e.values());
      }
    }
  ]),
  c);
  function c() {
    var e = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : {};
    s(this, c), (this.filtersJSON = e);
  }
  var p = "7.9.0";
  function y() {
    s(this, y), (this.cache = {});
  }
  var v = new (t(y, [
      {
        key: "getKey",
        value: function(e, t, n) {
          return e + t + JSON.stringify(n);
        }
      },
      {
        key: "store",
        value: function(e, t) {
          this.cache[e] = t;
        }
      },
      {
        key: "retrieve",
        value: function(e) {
          return this.cache[e];
        }
      }
    ]),
    y)(),
    g = new AbortController(),
    m = null,
    w = 0;
  function b(e, t, n, r, i, a) {
    var s = (5 < arguments.length && void 0 !== a ? a : {}).additionalHeaders,
      o = v.getKey("POST", t + n, r);
    if (i) {
      a = v.retrieve(o);
      if (a) return Promise.resolve(a);
    }
    return (function(e, t, n, r, i) {
      var a = (5 < arguments.length && void 0 !== arguments[5]
        ? arguments[5]
        : {}
      ).additionalHeaders;
      0 < w && null !== m && (g.abort(), (g = new AbortController()));
      (m = g.signal), ++w;
      a = new Headers(
        h(
          {
            Authorization: "Bearer " + t,
            "Content-Type": "application/json",
            "X-Swiftype-Client": "elastic-app-search-javascript",
            "X-Swiftype-Client-Version": p
          },
          a
        )
      );
      return fetch("" + n + r, {
        method: e,
        headers: a,
        body: JSON.stringify(i),
        credentials: "include",
        signal: m
      });
    })("POST", e, t, n, r, { additionalHeaders: s })
      .then(function(t) {
        return (
          (w = Math.max(0, --w)),
          t
            .json()
            .then(function(e) {
              e = { response: t, json: e };
              return i && v.store(o, e), e;
            })
            .catch(function() {
              return { response: t, json: {} };
            })
        );
      })
      .catch(function(e) {
        return { response: { ok: !1, message: "aborted" } };
      });
  }
  var S = "SEARCH",
    j = "MULTI_SEARCH";
  function O(e) {
    return new o(
      e.results,
      (function(e, t) {
        if (e) {
          e[t];
          return i(e, [t]);
        }
      })(e, "results")
    );
  }
  function A(e) {
    var t = e.response,
      n = e.json;
    if (t.ok) return n;
    if (void 0 !== t.message && "aborted" === t.message)
      throw new Error(t.message);
    n = Array.isArray(n)
      ? " " +
        ((e = n.map(function(e) {
          return e.errors;
        })),
        [].concat.apply([], e).join(", "))
      : n.errors
        ? " " + n.errors
        : "";
    throw new Error("[" + t.status + "]" + n);
  }
  var k = (t(P, [
    {
      key: "querySuggestion",
      value: function(e, t) {
        (t = 1 < arguments.length && void 0 !== t ? t : {}),
          (t = Object.assign({ query: e }, t));
        return b(
          this.searchKey,
          this.apiEndpoint,
          this.querySuggestionPath,
          t,
          this.cacheResponses,
          { additionalHeaders: this.additionalHeaders }
        ).then(A);
      }
    },
    {
      key: "search",
      value: function(e, t) {
        var n = 1 < arguments.length && void 0 !== t ? t : {},
          r = n.disjunctiveFacets,
          t = n.disjunctiveFacetsAnalyticsTags,
          n = i(n, ["disjunctiveFacets", "disjunctiveFacetsAnalyticsTags"]),
          n = Object.assign({ query: e }, n);
        return (r && 0 < r.length
          ? this._performDisjunctiveSearch(n, r, t)
          : this._performSearch(n)
        ).then(O);
      }
    },
    {
      key: "multiSearch",
      value: function(e) {
        e = e.map(function(e) {
          return h({ query: e.query }, e.options || {});
        });
        return this._performSearch({ queries: e }, j).then(function(e) {
          return e.map(O);
        });
      }
    },
    {
      key: "_performDisjunctiveSearch",
      value: function(t, n, e) {
        var r = this,
          i = 2 < arguments.length && void 0 !== e ? e : ["Facet-Only"],
          a = this._performSearch(t),
          s = new d(t.filters),
          e = s.getListOfAppliedFilters().filter(function(e) {
            return n.includes(e);
          });
        if (!e.length) return a;
        var o = t.page || {},
          c = t.analytics || {};
        c.tags = i;
        e = e.map(function(e) {
          return r._performSearch(
            h({}, t, {
              filters: s.removeFilter(e).filtersJSON,
              page: h({}, o, { size: 0 }),
              analytics: c,
              facets: u({}, e, t.facets[e])
            })
          );
        });
        return Promise.all([a].concat(l(e))).then(function(e) {
          var e = ((e = e), Array.isArray(e) ? e : Array.from(e)),
            n = e[0];
          return (
            e.slice(1).forEach(function(e) {
              var t = f(Object.entries(e.facets)[0], 2),
                e = t[0],
                t = t[1];
              n.facets[e] = t;
            }),
            n
          );
        });
      }
    },
    {
      key: "_performSearch",
      value: function(e, t) {
        t =
          (1 < arguments.length && void 0 !== t ? t : S) === j
            ? this.multiSearchPath
            : this.searchPath;
        return b(
          this.searchKey,
          this.apiEndpoint,
          t + ".json",
          e,
          this.cacheResponses,
          { additionalHeaders: this.additionalHeaders }
        ).then(A);
      }
    },
    {
      key: "click",
      value: function(e) {
        e.query, e.documentId, e.requestId, e.tags;
      }
    }
  ]),
  P);
  function P(e, t, n) {
    var r = 3 < arguments.length && void 0 !== arguments[3] ? arguments[3] : {},
      i = r.endpointBase,
      a = void 0 === i ? "" : i,
      i = r.cacheResponses,
      i = void 0 === i || i,
      r = r.additionalHeaders;
    s(this, P),
      (this.additionalHeaders = r),
      (this.searchKey = t),
      (this.cacheResponses = i),
      (this.engineName = n),
      (this.apiEndpoint = a
        ? a + "/api/as/v1/"
        : "https://" + e + ".api.swiftype.com/api/as/v1/"),
      (this.searchPath = "engines/" + this.engineName + "/search"),
      (this.multiSearchPath = "engines/" + this.engineName + "/multi_search"),
      (this.querySuggestionPath =
        "engines/" + this.engineName + "/query_suggestion"),
      (this.clickPath = "engines/" + this.engineName + "/click");
  }
  (e.createClient = function(e) {
    var t = e.hostIdentifier,
      n = e.accountHostKey,
      r = e.apiKey,
      i = e.searchKey,
      a = e.engineName,
      s = e.endpointBase,
      o = e.cacheResponses,
      e = e.additionalHeaders;
    return new k((t = t || n), (i = i || r), a, {
      endpointBase: s,
      cacheResponses: o,
      additionalHeaders: e
    });
  }),
    Object.defineProperty(e, "__esModule", { value: !0 });
});
